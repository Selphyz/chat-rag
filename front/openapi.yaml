openapi: 3.1.0
paths:
  /api/health:
    get:
      description: >-
        Returns the overall health status of the application including database
        and Ollama connectivity
      operationId: AppController_healthCheck
      parameters: []
      responses:
        '200':
          description: Application is healthy
          content:
            application/json:
              schema:
                example:
                  status: degraded
                  timestamp: '2025-11-14T23:30:00.000Z'
                  uptime: 125.5
                  services:
                    database:
                      status: connected
                      type: postgres
                    ollama:
                      status: unhealthy
                      model: llama3.2
                      embeddingModel: nomic-embed-text
                    qdrant:
                      status: healthy
                      collection: documents_collection
      summary: Get general health status
      tags:
        - Health
  /api/health/db:
    get:
      description: Performs a test query to verify database connection is working
      operationId: AppController_databaseHealth
      parameters: []
      responses:
        '200':
          description: Database is connected
          content:
            application/json:
              schema:
                example:
                  status: ok
                  database: connected
      summary: Check database connectivity
      tags:
        - Health
  /api/health/ollama:
    get:
      description: >-
        Returns status information from the Ollama runtime including which
        models are available
      operationId: AppController_ollamaHealth
      parameters: []
      responses:
        '200':
          description: Ollama status retrieved
          content:
            application/json:
              schema:
                example:
                  status: ok
                  models:
                    - llama3.2
                    - nomic-embed-text
                  currentModel: llama3.2
                  embeddingModel: nomic-embed-text
      summary: Check Ollama connectivity and available models
      tags:
        - Health
  /api/health/qdrant:
    get:
      description: >-
        Returns Qdrant health status, collection information, and current vector
        count
      operationId: AppController_qdrantHealth
      parameters: []
      responses:
        '200':
          description: Qdrant status retrieved
          content:
            application/json:
              schema:
                example:
                  status: ok
                  collection: documents_collection
                  vectorCount: 10
                  collectionInfo:
                    status: green
                    vectors_count: 10
      summary: Check Qdrant connectivity and collection details
      tags:
        - Health
  /api/auth/register:
    post:
      operationId: AuthController_register
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterDto'
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponseDto'
              example:
                access_token: >-
                  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ
                user:
                  id: uuid-string
                  email: user@example.com
        '400':
          description: Validation failed
        '409':
          description: Email already registered
      summary: Register a new user
      tags:
        - Auth
  /api/auth/login:
    post:
      operationId: AuthController_login
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginDto'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponseDto'
              example:
                access_token: >-
                  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ
                user:
                  id: uuid-string
                  email: user@example.com
        '400':
          description: Validation failed
        '401':
          description: Invalid credentials
      summary: Login with email and password
      tags:
        - Auth
  /api/auth/profile:
    get:
      operationId: AuthController_getProfile
      parameters: []
      responses:
        '200':
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
              example:
                id: uuid-string
                email: user@example.com
                createdAt: '2025-11-14T10:00:00.000Z'
                updatedAt: '2025-11-14T10:00:00.000Z'
        '401':
          description: Unauthorized - invalid or missing token
      security:
        - bearer: []
      summary: Get current user profile
      tags:
        - Auth
  /api/chats:
    post:
      operationId: ChatController_createChat
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChatDto'
      responses:
        '201':
          description: ''
      tags:
        - Chat
    get:
      operationId: ChatController_listChats
      parameters: []
      responses:
        '200':
          description: ''
      tags:
        - Chat
  /api/chats/{id}:
    get:
      operationId: ChatController_getChat
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags:
        - Chat
    delete:
      operationId: ChatController_deleteChat
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags:
        - Chat
  /api/chats/{id}/messages:
    post:
      operationId: ChatController_sendMessage
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendMessageDto'
      responses:
        '201':
          description: ''
      tags:
        - Chat
  /api/ollama/test-chat:
    post:
      operationId: OllamaController_testChat
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TestChatDto'
      responses:
        '201':
          description: Returns the LLM response for the provided prompt
          content:
            application/json:
              schema:
                example:
                  request: Hello!
                  response: Hello! How can I assist you today?
      security:
        - bearer: []
      summary: Send a test chat message to the configured Ollama model
      tags:
        - Ollama
  /api/ollama/test-embedding:
    post:
      operationId: OllamaController_testEmbedding
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TestChatDto'
      responses:
        '201':
          description: Returns information about the generated embedding
          content:
            application/json:
              schema:
                example:
                  text: This is a test document for embedding
                  embeddingDimension: 768
                  embedding:
                    - 0.12
                    - -0.02
                    - 0.93
      security:
        - bearer: []
      summary: Generate an embedding for a sample piece of text
      tags:
        - Ollama
  /api/ollama/models:
    get:
      operationId: OllamaController_listModels
      parameters: []
      responses:
        '200':
          description: Returns model metadata from Ollama
          content:
            application/json:
              schema:
                example:
                  models:
                    - llama3.2
                    - nomic-embed-text
                  currentModel: llama3.2
                  embeddingModel: nomic-embed-text
      security:
        - bearer: []
      summary: List all models currently pulled in Ollama
      tags:
        - Ollama
  /api/qdrant/test-insert:
    post:
      operationId: QdrantController_testInsert
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InsertTestVectorDto'
      responses:
        '201':
          description: ''
      security:
        - access-token: []
      summary: Insert a random test vector into Qdrant
      tags:
        - Qdrant
  /api/qdrant/test-search:
    post:
      operationId: QdrantController_testSearch
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchTestDto'
      responses:
        '201':
          description: ''
      security:
        - access-token: []
      summary: Search for vectors using a random test embedding
      tags:
        - Qdrant
  /api/qdrant/info:
    get:
      operationId: QdrantController_getInfo
      parameters: []
      responses:
        '200':
          description: ''
      security:
        - access-token: []
      summary: Fetch Qdrant collection information
      tags:
        - Qdrant
  /api/qdrant/test/{id}:
    delete:
      operationId: QdrantController_testDelete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      security:
        - access-token: []
      summary: Delete a vector by ID from Qdrant
      tags:
        - Qdrant
  /api/documents/upload:
    post:
      operationId: DocumentsController_uploadDocument
      parameters: []
      responses:
        '201':
          description: ''
      tags:
        - Documents
  /api/documents:
    get:
      operationId: DocumentsController_listDocuments
      parameters: []
      responses:
        '200':
          description: ''
      tags:
        - Documents
  /api/documents/{id}:
    get:
      operationId: DocumentsController_getDocument
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags:
        - Documents
    delete:
      operationId: DocumentsController_deleteDocument
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags:
        - Documents
  /api/documents/{id}/reprocess:
    post:
      operationId: DocumentsController_reprocessDocument
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '201':
          description: ''
      tags:
        - Documents
info:
  title: Chat RAG Backend API
  description: >-
    A Retrieval-Augmented Generation (RAG) chat application backend with
    document processing and vector search capabilities
  version: 1.0.0
  contact: {}
tags:
  - name: Auth
    description: User authentication and authorization
  - name: Chat
    description: Chat session and message management
  - name: Documents
    description: Document upload and processing
  - name: Health
    description: Health check endpoints
  - name: Qdrant
    description: Qdrant vector diagnostics and utilities
servers: []
components:
  securitySchemes:
    access-token:
      scheme: bearer
      bearerFormat: JWT
      type: http
  schemas:
    RegisterDto:
      type: object
      properties:
        email:
          type: string
          description: User email address
          example: user@example.com
        password:
          type: string
          description: User password (minimum 6 characters)
          example: password123
          minLength: 6
      required:
        - email
        - password
    AuthResponseDto:
      type: object
      properties:
        access_token:
          type: string
          description: JWT access token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        user:
          type: object
          description: User information
          example:
            id: uuid-here
            email: user@example.com
      required:
        - access_token
        - user
    LoginDto:
      type: object
      properties:
        email:
          type: string
          description: User email address
          example: user@example.com
        password:
          type: string
          description: User password
          example: password123
      required:
        - email
        - password
    User:
      type: object
      properties: {}
    CreateChatDto:
      type: object
      properties: {}
    SendMessageDto:
      type: object
      properties: {}
    TestChatDto:
      type: object
      properties:
        message:
          type: string
          description: Message that will be sent to the Ollama chat model
          example: What is Retrieval Augmented Generation?
      required:
        - message
    InsertTestVectorDto:
      type: object
      properties: {}
    SearchTestDto:
      type: object
      properties: {}
